# 纸牌程序设计（需求一）程序设计与实现说明

## 1. 项目概述

本项目基于 **cocos2d-x 3.17** 实现一个简单的纸牌消除小游戏。游戏按照课程给定的《纸牌程序设计【需求一】》需求文档实现，采用 **MVC + Managers + Services + Utils** 的分层架构，以保证代码的可维护性与可扩展性。:contentReference[oaicite:1]{index=1}

### 1.1 游戏规则简述

- 初始有一个**底牌区（手牌区顶部牌）**和若干张**主牌区（桌面牌）**。
- 玩家可以：
  - 点击**手牌区**：从牌堆翻出新的牌覆盖到底牌区顶部。
  - 点击**主牌区翻开的牌**：若该牌点数与当前底牌点数相差 1（无花色要求），则匹配成功，被移到底牌区并成为新的底牌。
  - 点击**回退按钮**：按相反顺序撤销上一操作（包括翻牌与匹配），卡牌平移回原处，直至没有可回退记录。
- 当主牌区无可匹配牌时，可继续从备用牌堆抽牌；备用牌耗尽且无可匹配时游戏进入无路可走状态。

### 1.2 开发环境与运行设置

- 引擎：cocos2d-x 3.17
- 目标平台：Windows（Visual Studio 工程） / 其他平台可按 cocos 官方流程生成
- 设计分辨率：1080 × 2080，窗口大小同 1080 × 2080 :contentReference[oaicite:2]{index=2}
  - 初始化代码类似：
    ```cpp
    glview = GLViewImpl::createWithRect("CardGame",
        cocos2d::Rect(0, 0, 1080, 2080), 0.5f);
    glview->setDesignResolutionSize(1080, 2080, ResolutionPolicy::FIXED_WIDTH);
    ```

---

## 2. 需求分析

### 2.1 功能性需求

1. **主玩法（匹配消除）**
   - 支持主牌区翻开的牌与底牌区牌点数差 1 即可匹配。
   - 无花色限制，点数循环不考虑（本需求不包含 A 与 K 相邻等特殊规则）。

2. **手牌区翻牌**
   - 玩家点击手牌区时，从牌堆取出一张新牌。
   - 新牌通过简单 `MoveTo` 动画移动到底牌区顶部位置，并替换当前底牌。

3. **主牌区匹配**
   - 玩家点击一张满足条件的桌面牌：
     - 逻辑判断通过后，桌面牌以移动动画平移到底牌区顶部。
     - 替换为新的底牌，原底牌从视图层移除或进入已消除区。

4. **回退功能（Undo）**
   - 记录玩家操作序列（翻牌 / 匹配）。
   - 玩家每点击一次回退按钮，按 **时间逆序** 回滚一步操作：
     - 卡牌顺着原路径反向 `MoveTo` 回到原位置。
     - Model 中牌的归属与状态同步恢复。
   - 当无回退记录时，回退按钮不再生效（或置灰）。

### 2.2 非功能性需求

- **结构化设计**：严格按照 MVC 架构组织代码，分离 UI、业务逻辑和数据。:contentReference[oaicite:3]{index=3}  
- **可扩展性**：容易新增关卡配置、新类型的卡牌和新的回退类型。
- **代码规范**：
  - 类名首字母大写；函数和变量名采用小驼峰。
  - 私有成员以下划线 `_` 开头；常量以 `k` 开头。:contentReference[oaicite:4]{index=4}  

---

## 3. 总体设计

### 3.1 项目目录结构（Classes）

工程下 `Classes/` 目录采用如下分层：:contentReference[oaicite:5]{index=5}

```text
Classes/
├── configs/      # 关卡、资源等静态配置
├── models/       # 运行时数据模型
├── views/        # 所有 UI 展示组件
├── controllers/  # 控制器层，负责业务逻辑
├── managers/     # 管理器层，如撤销管理
├── services/     # 无状态服务，负责通用业务处理
└── utils/        # 工具函数
